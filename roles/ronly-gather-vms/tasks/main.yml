---
# Tasks file for roles/ronly-gather-vms
- name: Ensure required Python packages are installed (user scope)
  ansible.builtin.pip:
    name: "{{ item.name }}=={{ item.version }}"
    executable: pip3
  loop: "{{ user_pip_packages }}"

- name: Get teh available Droplets info
  digitalocean.cloud.droplets_info:
    token: "{{ token }}"
  register: droplets
    
- name: Extract id and name using json_query
  set_fact:
    droplet_summary: "{{ droplets.data | json_query('[].{id: id, name: name}') }}"

- name: Show filtered droplet info
  debug:
    msg: "{{ droplet_summary }}"
    
- name: Show droplet count
  debug:
    msg: "Total droplets: {{ droplet_summary | length }}"
